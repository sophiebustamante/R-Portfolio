
## EPI 570
## Lab 2 Starter R File


## ---- eval=FALSE----------------------------------------------------------------------------------
## knitr::purl("path/to/file/XYZ.Rmd")


## ----load, message=FALSE, warning=FALSE-----------------------------------------------------------
library("EpiModel")


## -------------------------------------------------------------------------------------------------
help("icm")


## -------------------------------------------------------------------------------------------------
set.seed(12345)


## -------------------------------------------------------------------------------------------------
param <- param.icm(inf.prob = 1, act.rate = 0.2)
init <- init.icm(s.num = 9, i.num = 1)
control <- control.icm(type = "SI", nsteps = 50, nsims = 1)


## ---- message=FALSE, results="hide"---------------------------------------------------------------
sim <- icm(param, init, control)


## -------------------------------------------------------------------------------------------------
sim


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,1), mar = c(3,3,2,1), mgp = c(2,1,0))
plot(sim, main = "Compartment Frequencies")


## -------------------------------------------------------------------------------------------------
help("plot.icm")


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,2))
plot(sim, mean.smooth = FALSE, main = "Compartment Sizes")
plot(sim, mean.smooth = FALSE, popfrac = TRUE, main = "Compartment Frequencies")


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,2))
plot(sim, y = "i.num", mean.smooth = FALSE, main = "Disease Prevalence")
plot(sim, y = "si.flow", mean.smooth = FALSE, main = "Disease Incidence")


## -------------------------------------------------------------------------------------------------
df <- as.data.frame(sim)
head(df, 20)
tail(df)


## -------------------------------------------------------------------------------------------------
min(df$i.num)
max(df$i.num)


## -------------------------------------------------------------------------------------------------
which.max(df$i.num)
which.min(df$s.num)


## ---- message=FALSE, results="hide"---------------------------------------------------------------
control <- control.icm(type = "SI", nsteps = 50, nsims = 25)
sim <- icm(param, init, control)


## -------------------------------------------------------------------------------------------------
sim


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,1))
plot(sim, main = "Compartment Frequencies")


## -------------------------------------------------------------------------------------------------
plot(sim, sim.lines = TRUE, mean.line = FALSE, qnts = FALSE)


## -------------------------------------------------------------------------------------------------
plot(sim, qnts = 1, sim.lines = TRUE)


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,2))
plot(sim, qnts = 0.5, qnts.smooth = FALSE, mean.smooth = FALSE)
plot(sim, sim.lines = TRUE, qnts = 1, qnts.smooth = FALSE, mean.line = FALSE)


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,2))
plot(sim, y = "si.flow")
plot(sim, y = "si.flow", mean.smooth = FALSE, sim.lines = TRUE, qnts = FALSE)


## -------------------------------------------------------------------------------------------------
summary(sim, at = 20)


## -------------------------------------------------------------------------------------------------
df <- as.data.frame(sim, out = "mean")
head(df, 20)
min(df$i.num)
max(df$i.num)


## -------------------------------------------------------------------------------------------------
max(df$si.flow)


## -------------------------------------------------------------------------------------------------
which.max(df$si.flow)


## -------------------------------------------------------------------------------------------------
summary(sim, at = which.max(df$si.flow))


## -------------------------------------------------------------------------------------------------
init <- init.icm(s.num = 90, i.num = 10)


## ---- message=FALSE, results="hide"---------------------------------------------------------------
sim <- icm(param, init, control)
sim


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,1))
plot(sim, sim.lines = TRUE)


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,2))
plot(sim, y = "si.flow")
plot(sim, y = "si.flow", sim.lines = TRUE, qnts = 1,
     qnts.smooth = FALSE, mean.col = "black")


## -------------------------------------------------------------------------------------------------
dfL <- as.data.frame(sim, out = "qnt", qval = 0.25)
dfU <- as.data.frame(sim, out = "qnt", qval = 0.75)


## -------------------------------------------------------------------------------------------------
time.of.peak.incidence <- which.max(df$si.flow)
dfL$si.flow[time.of.peak.incidence]
dfU$si.flow[time.of.peak.incidence]


## -------------------------------------------------------------------------------------------------
help("dcm")


## -------------------------------------------------------------------------------------------------
param <- param.dcm(inf.prob = 0.1, act.rate = 0.6, rec.rate = 0.025)
init <- init.dcm(s.num = 999, i.num = 1, r.num = 0)
control <- control.dcm(type = "SIR", nsteps = 600)


## -------------------------------------------------------------------------------------------------
sim <- dcm(param, init, control)
sim


## -------------------------------------------------------------------------------------------------
plot(sim, main = "Default Prevalence Plot")


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,2))
plot(sim, y = "i.num", main = "Prevalence Only")
plot(sim, y = c("si.flow", "ir.flow"), legend = "full", main = "Incidence and Recoveries")


## ---- eval=FALSE----------------------------------------------------------------------------------
## help("plot.dcm")


## -------------------------------------------------------------------------------------------------
df <- as.data.frame(sim)
head(df)


## -------------------------------------------------------------------------------------------------
peak.incid <- max(df$si.flow)


## -------------------------------------------------------------------------------------------------
par(mfrow = c(1,1))
plot(sim, y = c("si.flow", "ir.flow"), legend = "full", main = "Incidence and Recoveries")
abline(h = peak.incid, v = which.max(df$si.flow))


## -------------------------------------------------------------------------------------------------
summary(sim, at = 100)
